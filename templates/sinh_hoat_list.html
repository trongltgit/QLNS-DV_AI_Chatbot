{# templates/sinh_hoat_list.html
   Yêu cầu backend: render_template("chi_bo_sinh_hoat.html", chi=chi, sinhhoats=sinhhoats, dangviens=dangviens)
#}
{% extends "base.html" %}
{% block title %}Buổi sinh hoạt - {{ chi.name }}{% endblock %}

{% block content %}
<div class="container py-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4><i class="fas fa-calendar-alt"></i> Buổi sinh hoạt — {{ chi.name }}</h4>
    <div>
      {% if user and (user.role == 'admin' or user.username == chi.name ~ '_leader') %}
      <!-- bạn sẽ kiểm tra leader bằng backend (hoặc bằng flag) -->
      <button class="btn btn-success" data-bs-toggle="collapse" data-bs-target="#createSH">+ Thêm buổi</button>
      {% endif %}
      <a href="/chi_bo/{{ chi.id }}/members" class="btn btn-outline-secondary">Thành viên</a>
    </div>
  </div>

  <div id="createSH" class="collapse mb-3">
    <div class="card card-body">
      <form method="post" action="/chi_bo/{{ chi.id }}/sinh_hoat/create" class="row g-2">
        <div class="col-md-4">
          <input name="tieu_de" class="form-control" placeholder="Tiêu đề buổi (vd: Học tập nghị quyết...)" required>
        </div>
        <div class="col-md-3">
          <input name="ngay_sinh_hoat" type="datetime-local" class="form-control" required>
        </div>
        <div class="col-md-2">
          <select name="hinh_thuc" class="form-select">
            <option value="truc_tiep">Trực tiếp</option>
            <option value="truc_tuyen">Trực tuyến</option>
          </select>
        </div>
        <div class="col-md-3">
          <button class="btn btn-primary w-100">Tạo buổi</button>
        </div>
        <div class="col-12 mt-2">
          <textarea name="noi_dung" class="form-control" rows="3" placeholder="Nội dung tóm tắt (tuỳ chọn)"></textarea>
        </div>
      </form>
    </div>
  </div>

  <div class="row">
    {% for sh in sinhhoats %}
    <div class="col-md-6">
      <div class="card mb-3">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <h5 class="mb-1">{{ sh.tieu_de }}</h5>
            <small class="text-muted">{{ sh.ngay_sinh_hoat.strftime('%Y-%m-%d %H:%M') }}</small>
          </div>
          <p class="mb-1 text-truncate">{{ sh.noi_dung or '' }}</p>
          <div class="d-flex gap-2">
            <a href="/sinh_hoat/{{ sh.id }}" class="btn btn-outline-primary btn-sm">Chi tiết</a>
            {% if user and (user.role == 'admin' or user.username == chi.name ~ '_leader') %}
            <form method="post" action="/sinh_hoat/{{ sh.id }}/delete" onsubmit="return confirm('Xác nhận xoá?');">
              <button class="btn btn-danger btn-sm">Xoá</button>
            </form>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% else %}
    <div class="col-12">
      <div class="alert alert-info">Chưa có buổi sinh hoạt.</div>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
