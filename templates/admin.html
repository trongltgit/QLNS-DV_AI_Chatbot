{% extends "base.html" %}
{% block content %}
<h3>QUẢN TRỊ HỆ THỐNG</h3>

<div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
    <section>
        <h4>Thêm Người dùng</h4>
        <form action="{{ url_for('admin_add_user') }}" method="POST">
            <input type="text" name="username" placeholder="Username" required style="width:90%; padding:8px; margin-bottom:10px;"><br>
            <input type="text" name="name" placeholder="Họ và tên" required style="width:90%; padding:8px; margin-bottom:10px;"><br>
            <input type="password" name="password" placeholder="Mật khẩu" required style="width:90%; padding:8px; margin-bottom:10px;"><br>
            <select name="role" style="width:94%; padding:8px; margin-bottom:10px;">
                <option value="dangvien">Đảng viên</option>
                <option value="bithu">Bí thư Chi bộ</option>
            </select><br>
            <select name="chi_bo_id" style="width:94%; padding:8px; margin-bottom:10px;">
                {% for cid, cb in CHI_BO_LIST.items() %}
                <option value="{{ cid }}">{{ cb.name }}</option>
                {% endfor %}
            </select><br>
            <button type="submit">Tạo tài khoản</button>
        </form>
    </section>

    <section>
        <h4>Chuyển Chi Bộ</h4>
        <form action="{{ url_for('admin_move_user') }}" method="POST">
            <select name="username" style="width:94%; padding:8px; margin-bottom:10px;">
                {% for u in USERS %}<option value="{{ u }}">{{ u }}</option>{% endfor %}
            </select><br>
            <select name="to_cb" style="width:94%; padding:8px; margin-bottom:10px;">
                {% for cid, cb in CHI_BO_LIST.items() %}
                <option value="{{ cid }}">{{ cb.name }}</option>
                {% endfor %}
            </select><br>
            <button type="submit">Xác nhận chuyển</button>
        </form>
    </section>
</div>

<hr>
<h4>Danh sách Người dùng</h4>
<table>
    <tr>
        <th>Username</th>
        <th>Họ tên</th>
        <th>Vai trò</th>
        <th>Thao tác</th>
    </tr>
    {% for u, info in USERS.items() %}
    <tr>
        <td>{{ u }}</td>
        <td>{{ info.name }}</td>
        <td>{{ info.role }}</td>
        <td>
            <a href="{{ url_for('admin_reset_pw', username=u) }}" class="btn" style="background:#fbc02d; color:black;">Reset PW</a>
            <a href="{{ url_for('admin_delete', username=u) }}" class="btn btn-red" onclick="return confirm('Xóa?')">Xóa</a>
        </td>
    </tr>
    {% endfor %}
</table>
{% endblock %}
